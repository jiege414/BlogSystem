# 博客系统测试用例

## 测试用例说明
- **优先级**：P0（关键功能）、P1（重要功能）、P2（一般功能）
- **状态**：待执行、执行中、已通过、已失败、已阻塞
- **前置条件**：执行测试用例前需要满足的条件

---

## 一、用户认证模块测试

### TC-AUTH-001：用户注册 - 正常流程
**优先级**：P0  
**前置条件**：访问注册页面  
**测试步骤**：
1. 访问 `/auth/register`
2. 输入有效的用户名（4-64字符）
3. 输入有效的邮箱地址
4. 输入密码（至少6字符）
5. 输入确认密码（与密码一致）
6. 点击"注册"按钮

**预期结果**：
- 注册成功，显示"注册成功！请登录。"提示
- 自动跳转到登录页面
- 数据库中创建新用户记录
- 密码以哈希形式存储

---

### TC-AUTH-002：用户注册 - 用户名已存在
**优先级**：P1  
**前置条件**：已存在用户名为"test01"的用户  
**测试步骤**：
1. 访问注册页面
2. 输入已存在的用户名"test01"
3. 输入其他有效信息
4. 提交表单

**预期结果**：
- 显示错误提示："该用户名已被使用，请选择其他用户名。"
- 停留在注册页面
- 不创建新用户

---

### TC-AUTH-003：用户注册 - 邮箱已注册
**优先级**：P1  
**前置条件**：已存在邮箱为"test@example.com"的用户  
**测试步骤**：
1. 访问注册页面
2. 输入已注册的邮箱"test@example.com"
3. 输入其他有效信息
4. 提交表单

**预期结果**：
- 显示错误提示："该邮箱已被注册，请使用其他邮箱或直接登录。"
- 停留在注册页面

---

### TC-AUTH-004：用户注册 - 用户名长度验证
**优先级**：P1  
**测试步骤**：
1. 访问注册页面
2. 输入用户名长度 < 4 字符（如"abc"）
3. 输入其他有效信息
4. 提交表单

**预期结果**：
- 显示错误提示："用户名长度必须在4-64个字符之间"
- 表单不提交

**测试步骤**（续）：
5. 尝试输入用户名长度 > 64 字符
6. 观察输入框行为

**预期结果**：
- 输入框在达到64个字符后无法继续输入（前端限制）
- 或：如果能够输入超过64个字符，提交表单后显示错误提示："用户名长度必须在4-64个字符之间"，表单不提交

**备注**：
- 前端限制输入长度是更好的用户体验实现方式
- 后端验证（Length(max=64)）仍然有效，确保数据安全

---

### TC-AUTH-005：用户注册 - 密码长度验证
**优先级**：P1  
**测试步骤**：
1. 访问注册页面
2. 输入密码长度 < 6 字符（如"12345"）
3. 输入其他有效信息
4. 提交表单

**预期结果**：
- 显示错误提示："密码长度至少为6个字符"
- 表单不提交

---

### TC-AUTH-006：用户注册 - 密码确认不一致
**优先级**：P1  
**测试步骤**：
1. 访问注册页面
2. 输入密码"123456"
3. 输入确认密码"654321"（不一致）
4. 提交表单

**预期结果**：
- 显示错误提示："两次输入的密码不一致"
- 表单不提交

---

### TC-AUTH-007：用户注册 - 邮箱格式验证
**优先级**：P1  
**测试步骤**：
1. 访问注册页面
2. 输入无效邮箱格式（如"invalid-email"）
3. 输入其他有效信息
4. 提交表单

**预期结果**：
- 显示错误提示："请输入有效的邮箱地址"
- 表单不提交

---

### TC-AUTH-008：用户登录 - 正常流程
**优先级**：P0  
**前置条件**：已注册用户（用户名：testuser，密码：123456）  
**测试步骤**：
1. 访问 `/auth/login`
2. 输入正确的用户名"testuser"
3. 输入正确的密码"123456"
4. 点击"登录"按钮

**预期结果**：
- 登录成功，显示"欢迎回来，testuser！"提示
- 跳转到首页
- 导航栏显示用户名和"登出"链接
- 显示"创建文章"按钮

---

### TC-AUTH-009：用户登录 - 用户名或密码错误
**优先级**：P1  
**前置条件**：已注册用户  
**测试步骤**：
1. 访问登录页面
2. 输入错误的用户名或密码
3. 提交表单

**预期结果**：
- 显示错误提示："用户名或密码错误，请重试。"
- 停留在登录页面
- 不创建会话

---

### TC-AUTH-010：用户登录 - 使用邮箱登录
**优先级**：P1  
**前置条件**：已注册用户（邮箱：test@example.com）  
**测试步骤**：
1. 访问登录页面
2. 在用户名字段输入邮箱"test@example.com"
3. 输入正确密码
4. 提交表单

**预期结果**：
- 登录成功（支持邮箱登录）
- 跳转到首页

---

### TC-AUTH-011：用户登录 - 已登录用户访问登录页
**优先级**：P2  
**前置条件**：用户已登录  
**测试步骤**：
1. 已登录状态下访问 `/auth/login`

**预期结果**：
- 自动重定向到首页
- 不显示登录表单

---

### TC-AUTH-012：用户登出
**优先级**：P0  
**前置条件**：用户已登录  
**测试步骤**：
1. 点击导航栏"登出"链接

**预期结果**：
- 显示"您已成功登出。"提示
- 跳转到首页
- 导航栏显示"登录"和"注册"链接
- 无法访问需要登录的页面

---

### TC-AUTH-013：未登录用户访问受保护页面
**优先级**：P1  
**测试步骤**：
1. 未登录状态下访问 `/blog/create`
2. 未登录状态下访问 `/blog/post/1/edit`

**预期结果**：
- 自动重定向到登录页面
- 显示提示："请先登录以访问此页面。"
- 登录后可以重定向回原页面（如果有next参数）

---

## 二、文章管理模块测试

### TC-POST-001：创建文章 - 正常流程
**优先级**：P0  
**前置条件**：用户已登录  
**测试步骤**：
1. 点击导航栏"创建文章"或访问 `/blog/create`
2. 输入文章标题（1-200字符）
3. 输入文章内容
4. 点击"发布文章"按钮

**预期结果**：
- 文章创建成功，显示"文章发布成功！"提示
- 跳转到首页
- 新文章显示在文章列表顶部
- 文章关联到当前登录用户

---

### TC-POST-002：创建文章 - 标题为空
**优先级**：P1  
**前置条件**：用户已登录  
**测试步骤**：
1. 访问创建文章页面
2. 标题字段留空
3. 输入文章内容
4. 提交表单

**预期结果**：
- 显示错误提示："请填写此字段"
- 表单不提交

---

### TC-POST-003：创建文章 - 标题超长
**优先级**：P1  
**测试步骤**：
1. 访问创建文章页面
2. 输入标题长度 > 200 字符
3. 输入文章内容
4. 提交表单

**预期结果**：
- 显示错误提示："标题长度必须在1-200个字符之间"
- 表单不提交

---

### TC-POST-004：创建文章 - 内容为空
**优先级**：P1  
**测试步骤**：
1. 访问创建文章页面
2. 输入标题
3. 内容字段留空
4. 提交表单

**预期结果**：
- 显示错误提示："请填写此字段"
- 表单不提交

---

### TC-POST-005：查看文章列表
**优先级**：P0  
**测试步骤**：
1. 访问首页 `/`
2. 查看文章列表

**预期结果**：
- 显示所有文章，按时间倒序排列（最新在前）
- 每篇文章显示：标题、作者、发布时间、内容摘要
- 文章卡片可点击，跳转到详情页
- 如果无文章，显示提示信息

---

### TC-POST-006：查看文章详情
**优先级**：P0  
**前置条件**：存在至少一篇文章  
**测试步骤**：
1. 在首页点击任意文章卡片
2. 或直接访问 `/blog/post/<post_id>`

**预期结果**：
- 显示文章完整内容
- 显示文章标题、作者、发布时间
- 显示"返回首页"按钮
- 如果当前用户是作者，显示"编辑"和"删除"按钮

---

### TC-POST-007：查看文章详情 - 文章不存在
**优先级**：P1  
**测试步骤**：
1. 访问不存在的文章ID，如 `/blog/post/99999`

**预期结果**：
- 返回404错误页面
- 不显示文章内容

---

### TC-POST-008：编辑文章 - 正常流程（作者）
**优先级**：P0  
**前置条件**：用户已登录，且是文章作者  
**测试步骤**：
1. 访问自己的文章详情页
2. 点击"编辑"按钮
3. 修改文章标题和内容
4. 点击"保存修改"按钮

**预期结果**：
- 编辑页面预填充原有内容
- 修改成功，显示"文章更新成功！"提示
- 跳转回文章详情页
- 显示更新后的内容
- 数据库中文章已更新

---

### TC-POST-009：编辑文章 - 非作者尝试编辑
**优先级**：P1  
**前置条件**：用户A已登录，文章属于用户B  
**测试步骤**：
1. 用户A访问用户B的文章详情页
2. 检查是否显示编辑按钮
3. 尝试直接访问编辑URL：`/blog/post/<post_id>/edit`

**预期结果**：
- 文章详情页不显示"编辑"按钮
- 直接访问编辑URL返回403错误
- 无法编辑他人文章

---

### TC-POST-010：编辑文章 - 未登录用户
**优先级**：P1  
**测试步骤**：
1. 未登录状态下访问 `/blog/post/1/edit`

**预期结果**：
- 重定向到登录页面
- 显示登录提示

---

### TC-POST-011：编辑文章 - 表单验证
**优先级**：P1  
**前置条件**：用户已登录，是文章作者  
**测试步骤**：
1. 访问编辑页面
2. 清空标题或内容
3. 提交表单

**预期结果**：
- 显示相应的验证错误提示
- 表单不提交

---

### TC-POST-012：删除文章 - 正常流程（作者）
**优先级**：P0  
**前置条件**：用户已登录，且是文章作者  
**测试步骤**：
1. 访问自己的文章详情页
2. 点击"删除"按钮
3. 在确认对话框中点击"确定"

**预期结果**：
- 显示确认对话框："确定要删除文章《标题》吗？此操作不可恢复！"
- 点击确定后，文章被删除
- 显示"文章已成功删除。"提示
- 跳转到首页
- 文章从列表中消失
- 数据库中文章记录被删除

---

### TC-POST-013：删除文章 - 取消删除
**优先级**：P1  
**前置条件**：用户已登录，且是文章作者  
**测试步骤**：
1. 访问文章详情页
2. 点击"删除"按钮
3. 在确认对话框中点击"取消"

**预期结果**：
- 对话框关闭
- 停留在文章详情页
- 文章未被删除

---

### TC-POST-014：删除文章 - 非作者尝试删除
**优先级**：P1  
**前置条件**：用户A已登录，文章属于用户B  
**测试步骤**：
1. 用户A访问用户B的文章详情页
2. 检查是否显示删除按钮
3. 尝试直接POST请求删除URL

**预期结果**：
- 文章详情页不显示"删除"按钮
- 直接POST请求返回403错误
- 无法删除他人文章

---

### TC-POST-015：删除文章 - 未登录用户
**优先级**：P1  
**测试步骤**：
1. 未登录状态下尝试POST请求 `/blog/post/1/delete`

**预期结果**：
- 重定向到登录页面

---

### TC-POST-016：文章列表 - 空状态
**优先级**：P2  
**前置条件**：数据库中无文章  
**测试步骤**：
1. 访问首页

**预期结果**：
- 显示提示："还没有任何文章"
- 如果已登录，显示"创建第一篇文章"按钮
- 如果未登录，显示登录提示

---

### TC-POST-017：文章列表 - 登录用户可见创建按钮
**优先级**：P1  
**前置条件**：用户已登录  
**测试步骤**：
1. 访问首页

**预期结果**：
- 页面右上角显示"创建文章"按钮
- 点击可跳转到创建页面

---

### TC-POST-018：文章列表 - 未登录用户
**优先级**：P1  
**前置条件**：用户未登录  
**测试步骤**：
1. 访问首页

**预期结果**：
- 不显示"创建文章"按钮
- 可以查看文章列表和详情
- 无法创建、编辑、删除文章

---

## 三、权限控制测试

### TC-PERM-001：文章编辑权限 - 仅作者可见编辑按钮
**优先级**：P0  
**前置条件**：用户A和用户B都已注册，用户A创建了文章  
**测试步骤**：
1. 用户A登录，访问自己的文章详情页
2. 用户B登录，访问用户A的文章详情页

**预期结果**：
- 用户A可以看到"编辑"和"删除"按钮
- 用户B看不到"编辑"和"删除"按钮

---

### TC-PERM-002：文章编辑权限 - 直接访问URL
**优先级**：P1  
**前置条件**：用户A和用户B都已注册，用户A创建了文章  
**测试步骤**：
1. 用户B登录
2. 直接访问 `/blog/post/<用户A的文章ID>/edit`

**预期结果**：
- 返回403错误
- 无法编辑

---

### TC-PERM-003：文章删除权限 - 直接POST请求
**优先级**：P1  
**前置条件**：用户A和用户B都已注册，用户A创建了文章  
**测试步骤**：
1. 用户B登录
2. 尝试POST请求 `/blog/post/<用户A的文章ID>/delete`

**预期结果**：
- 返回403错误
- 无法删除

---

## 四、安全测试

### TC-SEC-001：CSRF保护 - 创建文章
**优先级**：P1  
**前置条件**：用户已登录  
**测试步骤**：
1. 访问创建文章页面
2. 查看页面源代码，找到CSRF token
3. 尝试不包含CSRF token提交表单

**预期结果**：
- 表单包含CSRF token（hidden字段）
- 不包含token的请求被拒绝
- 显示CSRF验证错误

---

### TC-SEC-002：CSRF保护 - 删除文章
**优先级**：P1  
**前置条件**：用户已登录，是文章作者  
**测试步骤**：
1. 访问文章详情页
2. 查看删除表单的CSRF token
3. 尝试修改或删除token后提交

**预期结果**：
- 删除表单包含CSRF token
- 无效token的请求被拒绝

---

### TC-SEC-003：密码安全 - 密码哈希存储
**优先级**：P1  
**前置条件**：已注册用户  
**测试步骤**：
1. 使用数据库工具查看用户表
2. 检查password_hash字段

**预期结果**：
- 密码以哈希形式存储（不是明文）
- 哈希值长度合理（128字符）
- 相同密码的哈希值不同（使用了salt）

---

### TC-SEC-004：SQL注入防护 - 文章标题
**优先级**：P1  
**前置条件**：用户已登录  
**测试步骤**：
1. 创建文章时，标题输入SQL注入尝试：`'; DROP TABLE posts; --`
2. 提交表单

**预期结果**：
- 文章正常创建，标题作为普通文本存储
- 数据库表未被删除
- 无SQL错误

---

### TC-SEC-005：XSS防护 - 文章内容
**优先级**：P1  
**前置条件**：用户已登录  
**测试步骤**：
1. 创建文章时，内容输入：`<script>alert('XSS')</script>`
2. 提交并查看文章详情

**预期结果**：
- 内容正常显示为文本（Jinja2自动转义）
- 不执行JavaScript代码
- 无弹窗

---

### TC-SEC-006：会话管理 - 登出后无法访问
**优先级**：P1  
**前置条件**：用户已登录  
**测试步骤**：
1. 登录后访问 `/blog/create`
2. 点击登出
3. 尝试访问 `/blog/create`

**预期结果**：
- 登出后重定向到登录页
- 无法访问受保护页面

---

## 五、用户体验测试

### TC-UX-001：表单验证提示 - 实时显示
**优先级**：P2  
**测试步骤**：
1. 访问注册/登录/创建文章页面
2. 提交空表单
3. 观察错误提示

**预期结果**：
- 错误提示清晰明确
- 提示位置合理（字段下方）
- 使用对话框突出显示

---

### TC-UX-002：Flash消息显示
**优先级**：P2  
**测试步骤**：
1. 执行各种操作（注册、登录、创建文章等）
2. 观察成功/失败消息

**预期结果**：
- 成功消息显示为绿色（success类别）
- 错误消息显示为红色（danger类别）
- 消息可关闭（有关闭按钮）
- 消息自动消失或可手动关闭

---

### TC-UX-003：导航栏功能
**优先级**：P1  
**测试步骤**：
1. 未登录状态下查看导航栏
2. 登录后查看导航栏
3. 点击各个导航链接

**预期结果**：
- 未登录：显示"登录"、"注册"链接
- 已登录：显示用户名、"创建文章"、"登出"链接
- 所有链接正常工作
- 导航栏响应式设计（移动端可折叠）

---

### TC-UX-004：删除确认对话框
**优先级**：P1  
**前置条件**：用户已登录，是文章作者  
**测试步骤**：
1. 访问文章详情页
2. 点击"删除"按钮

**预期结果**：
- 显示确认对话框
- 对话框内容清晰："确定要删除文章《标题》吗？此操作不可恢复！"
- 可以取消操作

---

### TC-UX-005：表单预填充 - 编辑文章
**优先级**：P2  
**前置条件**：用户已登录，是文章作者  
**测试步骤**：
1. 访问文章编辑页面

**预期结果**：
- 标题和内容字段自动填充原有内容
- 用户可以在此基础上修改

---

### TC-UX-006：页面跳转逻辑
**优先级**：P2  
**测试步骤**：
1. 创建文章后
2. 编辑文章后
3. 删除文章后
4. 登录后（有next参数）

**预期结果**：
- 创建文章后跳转到首页
- 编辑文章后跳转到文章详情页
- 删除文章后跳转到首页
- 登录后跳转到原目标页面或首页

---

### TC-UX-007：文章列表点击区域
**优先级**：P2  
**测试步骤**：
1. 访问首页
2. 点击文章卡片的不同区域（标题、内容、空白处）

**预期结果**：
- 整个卡片区域都可点击
- 点击任意位置都跳转到文章详情页
- 有视觉提示（标题为蓝色，底部有"点击查看全文"提示）

---

## 六、边界和异常测试

### TC-BOUNDARY-001：文章标题边界值
**优先级**：P2  
**测试步骤**：
1. 创建文章，标题长度为1字符
2. 创建文章，标题长度为200字符
3. 创建文章，标题长度为201字符

**预期结果**：
- 1字符和200字符可以成功创建
- 201字符显示验证错误

---

### TC-BOUNDARY-002：文章内容边界值
**优先级**：P2  
**测试步骤**：
1. 创建文章，内容为空（仅空格）
2. 创建文章，内容为1字符
3. 创建文章，内容为超长文本（如10000字符）

**预期结果**：
- 空内容显示验证错误
- 1字符可以成功创建
- 超长文本可以成功创建（数据库支持）

---

### TC-BOUNDARY-003：用户名边界值
**优先级**：P2  
**测试步骤**：
1. 注册用户，用户名为4字符（最小）
2. 注册用户，用户名为64字符（最大）
3. 注册用户，用户名为3字符或65字符

**预期结果**：
- 4字符和64字符可以成功注册
- 3字符和65字符显示验证错误

---

### TC-BOUNDARY-004：密码边界值
**优先级**：P2  
**测试步骤**：
1. 注册用户，密码为6字符（最小）
2. 注册用户，密码为5字符

**预期结果**：
- 6字符可以成功注册
- 5字符显示验证错误

---

### TC-EXCEPTION-001：数据库错误处理
**优先级**：P2  
**测试步骤**：
1. 模拟数据库连接失败（如关闭数据库文件）
2. 尝试创建文章

**预期结果**：
- 显示友好的错误提示
- 不暴露数据库内部错误信息
- 应用不崩溃

---

### TC-EXCEPTION-002：并发操作
**优先级**：P2  
**前置条件**：两个用户同时操作  
**测试步骤**：
1. 用户A和用户B同时编辑同一篇文章（用户A的文章）
2. 用户A和用户B同时删除同一篇文章

**预期结果**：
- 权限检查正常工作
- 用户B无法编辑/删除用户A的文章
- 数据库操作正常（无死锁）

---

## 七、兼容性测试

### TC-COMPAT-001：浏览器兼容性 - Chrome
**优先级**：P1  
**测试步骤**：
1. 使用Chrome浏览器测试所有主要功能

**预期结果**：
- 所有功能正常工作
- 页面样式正常显示
- JavaScript功能正常

---

### TC-COMPAT-002：浏览器兼容性 - Edge
**优先级**：P2  
**测试步骤**：
1. 使用Edge浏览器测试主要功能

**预期结果**：
- 基本功能正常工作
- 页面样式正常显示

---

### TC-COMPAT-003：响应式设计 - 移动端
**优先级**：P2  
**测试步骤**：
1. 使用浏览器开发者工具切换到移动设备视图
2. 测试主要页面和功能

**预期结果**：
- 页面布局适配移动端
- 导航栏可折叠
- 表单和按钮大小合适
- 文字可读

---

## 测试用例统计
- **总计**：56个测试用例
- **P0（关键）**：9个
- **P1（重要）**：32个
- **P2（一般）**：15个

## 测试执行说明
1. 按照优先级顺序执行测试用例
2. 记录测试结果在 MANUAL_TESTING.md
3. 发现的问题记录在 BUG_REPORTS.md
4. 修复后执行回归测试

